[pytest]
# Pytest Configuration for PDF to Markdown MCP Server Tests
# ==============================================================================
# This configuration defines test markers and execution settings for three
# distinct test categories: unit, integration, and e2e tests.

# Test Discovery
# ==============================================================================
testpaths = .
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test Markers
# ==============================================================================
markers =
    unit: Fast unit tests with mocks (SQLite, CPU-only, no external services)
    integration: Integration tests with real services (requires GPU, PostgreSQL, Redis, Ollama)
    e2e: End-to-end pipeline tests (requires all services, GPU, full system)
    gpu: Tests requiring GPU/CUDA hardware
    slow: Slow-running tests (>30 seconds)
    database: Tests requiring database connection
    redis: Tests requiring Redis connection
    mineru: Tests requiring MinerU service
    embeddings: Tests requiring embedding service (Ollama)
    mcp: Tests for MCP server functionality
    security: Security-focused tests

# Async Test Configuration
# ==============================================================================
asyncio_mode = auto

# Test Output Configuration
# ==============================================================================
# Show extra test summary info
addopts =
    -v
    --tb=short
    --strict-markers
    -ra
    --color=yes

# Logging Configuration
# ==============================================================================
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Console Output
# ==============================================================================
console_output_style = progress

# Warning Handling
# ==============================================================================
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

# Test Execution Profiles
# ==============================================================================
# Run only unit tests (fast, no external dependencies):
#   pytest -m unit
#
# Run only integration tests (requires GPU + services):
#   pytest -m integration
#
# Run only e2e tests (full pipeline):
#   pytest -m e2e
#
# Run tests requiring GPU:
#   pytest -m gpu
#
# Run all tests except slow ones:
#   pytest -m "not slow"
#
# Run integration + e2e (all real resource tests):
#   pytest -m "integration or e2e"

# Performance Settings
# ==============================================================================
# Timeout for individual tests (in seconds)
# timeout = 300  # 5 minutes max per test (uncomment to enable)

# Coverage Settings
# ==============================================================================
# To run with coverage:
#   pytest --cov=src/pdf_to_markdown_mcp --cov-report=html --cov-report=term
#
# [tool:pytest_cov]
# cov_branch = true
# show_missing = true
